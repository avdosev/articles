# html2json

Как обычно мы храним в базе данных когда что-то нужно показать пользователю что обладает некоторомы свойствами разметки? Кто хотя бы раз делал свой блог, хабр или похожее сразу скажет - html. А что если я скажу что можно сделать иначе? JSON.

Я бы хотел рассмотреть преимущества и недостатки подобного хранения, ну или попытаться по крайней мере.

![Мем](./img/standarts_mem.jpg)

## Что? Json? Зачем это вообще надо?

**Описани:**

У нас имеется сервис, в бд мы храним html для отображения некоторого контента. 

Если я не ошибаюсь, то так как раз сделано на всем нами любимом или несильно - хабре. \
*(Я посмел предположить, что хабр хранит статьи именно в хтмл + оригинал того что прислал пользователь)*

**Проблема:**

Мы, как фронтендеры, должны поддерживать на клиенте некоторый набор легаси css или как то тяжело его обновлять.
Если наш фронтендер, например, захочет как то обновить наш UI, то он должны учитывать что на сервере весь хтмл в бд содержит старые классы css и волшебным образом не поменяется и скорее всего вообще меняться не будет.

Можно, например, посмотреть что выдается в для мобильной версии фронтенда хабра под недавним мегапостом [ссылка на апи](https://m.habr.com/kek/v2/articles/522630/). *Конечно, сомнительно (возможно очень), что пост хранится прям в таком виде в бд, но все может быть. (возможно, это связанно с тем что апи хабра до сих пор не открыто)*

***Внимание:*** ~~Не~~большой скрин просьба спрятать женщин, детей и слишком чувствительных гиков:

![Big article](./img/big_article.png)

Некоторое количество заинлайненого css и javascript осталось за кадром.

**Решение:**

А давайте хранить не хтмл а джсон, с определенной заранее или легко расширяемой структурой, что бы каждый элемент имел четкую структуру и был далек от представления у фронтендера.

**Профит который получим:**

Мы полностью абстрагировались от представления данных и сконцентрировались лишь на содержимом. Благодаря этому мы в любой момент сможем с достаточной простотой обновить код преобразования (или рендер) джсон в хтмл который мы отдаем в браузер. Только теперь мы сможем написать похожий рендер из джсона не только в хтмл, но и для нативных приложений без необходимости использовать Web View и аналоги.

## Давайте рассмотрим идею на примерах

Для этого предлагаю ознакомится с тем что выдает по api хабр (только уже без мега постов)

```html

```

И что предлагаю выдавать я:

```json

```

Все это я, конечно, переводил не в ручную. Я брал некоторые статьи (не все) и прогонял хтмл через свою небольшую консольную утилиту на Dart, её результаты работы  вы и увидели. Да, она написана не идеально, но для проверки концепта - сойдет.

Потыркать утилиту и посмореть код можно по ссылке на мой [репозиторий](https://github.com/avdosev/html2json).

## Небольшой бенчмарк

Давайте рассмотрим небольшой бенчмарк

**далее тут код бенчмарка и его объяснение**

Скорость парсинга статьи полностью из джсона и с хтмл внутри джсона по производительности не имеет разницы

но интересно другое
 
но если вы используете React, например, вместе с либой "html_to_react", которая использует "html-dom-parser", то становится чуть интереснее:

* тестируем библиотеку только для построения dom дерева, замеры для "html_to_react" не проводились
* разница в производительности становится около 2 раз не в пользу html

## Ок, а какие плюсы и минусы подобного решения?

плюсы:
1. Сделав подобное преобразование на сервере, в некоторых ситуациях можно немного ослабить нагрузку на гаджет пользователя
1. Независимость от хтмл
    
    Мы устраняем зависимость от того как хотим представлять на клиенте кнопку или спойлер, или цитату. независимы от css классов от различных атрибутов.

    Мы получаем возможность безболезненно создать на основе данных с сервера нативные виджеты, будь то андроид, ios, flutter, web или что-то из мира десктопа.

    И это все без WebView и аналогов.

1. Избавляемся от зависимостей

минусы:
1. json весит незначительно, но больше чем аналогичный html (но возможно и обратное если у вас более сложная структура, которая лучше поддается оптимизации)
1. json придется в любом случае конвертировать в нативные для данной платформы виджеты будь то веб с его хтмл или нативный мир уже с собственными особенностями
1. html очень многогранный и если есть необходимость поддерживать весь хтмл то, на мой взгляд, затея выглядит достаточно сомнительной и трудоемкой (не придешь ли ты случайно к тому что изобретешь браузер)
1. отсутвует стандарт, получается, что вы создаете велосипед и поддерживать его придется вам

## Это все конечно хорошо, но как можно это применить?

Вот мой небольшой список:

1. Хранение в бд
1. Создание платформо-независимого генерируемого в рантайме ui
1. Отказ от редакторов использующих html, написать собственный редактор получится проще
1. Думаю, можно продолжать дальше, но я больше ничего не смог придумать, надеюсь читатели помогут и предложат еще вариантов.

## Заключение

В качестве итога я бы хотел сказать, что не предлагаю всем разом переходить на описанное мной в данной статье. В первую очередь мне интересно мнение других разработчиков, как бекенд так и фронтенд. Скорее всего я не учел ньюансы и готов выслушать и обсудить критику данного решения.